{% extends 'master.html' %}

{% block title %}
    Home
{% endblock %}

{% block content %}
    {% for post in posts.items %}
        <div class="posts">
            <h2>
            <a class="post-title" href="{{ url_for('posts.post', post_id=post.id) }}">{{ post.title }}</a>
            </h2>
            <p>
            {{ post.timestamp.strftime('%Y %B %d') }}
            </p>
            {% if current_user.can_create_posts %}
                <div class="moderate-post">
                    <a href="{{ url_for('posts.update_post', post_id=post.id) }}">Update</a>
                    <form action="{{ url_for('posts.delete_post', post_id=post.id) }}" method="POST">
                    <a href="{{ url_for('posts.delete_post', post_id=post.id) }}">Delete</a>
                    </form>
                </div>
            {% endif %}
            <p>{{ post.content|truncate(2048)|striptags }}</p>
            <a href="{{ url_for('posts.post', post_id=post.id) }}">Read more</a>
            <a class="post-comments" href="{{ url_for('posts.post', post_id=post.id) }}#comments">Comments ({{ post.comments.count() }})</a>
            <hr>
        </div>
    {% endfor %}
    <div class="pagination">
    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
            {% if posts.page == page_num %}
                <a class="current-page" href="{{ url_for('main.home', page=page_num) }}">{{ page_num }}</a>
                {% else %}
                <a href="{{ url_for('main.home', page=page_num) }}" class="page-pagination">{{ page_num }}</a>
            {% endif %}
        {% else %}
            ...
        {% endif %}
    {% endfor %}
    </div>
{% endblock %}